# ElTool

Профессиональный AutoCAD-плагин для инженерных разделов ЭОМ/ЭМ: замена блоков, трассировка кабелей, формирование спецификаций, Excel-обмен, построение ОЛС и компоновка щита.

## Что делает проект

ElTool автоматизирует рутинные операции в проектировании внутренних электросетей:

- массовая замена сторонних блоков на стандартные библиотечные;
- расчет длины кабеля с учетом геометрии, высот и типа прокладки;
- агрегация данных по щитам и группам;
- экспорт данных в Excel и импорт расчетных результатов;
- построение однолинейной схемы (ОЛС) по результатам Excel;
- компоновка аппаратов щита по DIN-рядам;
- валидация проекта с переходом к проблемным объектам.

## Для кого

- инженеры ЭОМ/ЭМ в AutoCAD;
- BIM/CAD-координаторы;
- команды, которым нужен стабильный рабочий поток «чертеж ↔ расчет ↔ спецификация».

## Ключевые возможности

- Полный набор пользовательских команд в ленте `ЭОМ ПРО`.
- Работа с русскоязычными атрибутами блоков (`ГРУППА`, `МОЩНОСТЬ`, `ЩИТ`, `ПРИМЕЧАНИЕ` и др.).
- XData/metadata-подход для хранения расчетных данных в DWG.
- Поддержка сценариев экспорта/импорта для Excel-шаблона.
- Конфигурируемая компоновка щита через `PanelLayoutMap.json`.
- Диагностика и логирование всех ключевых этапов.

## Команды

Основные команды:

- `EOM_MAP` — замена блоков.
- `EOM_TRACE` — трассировка и расчет.
- `EOM_SPEC` — формирование спецификации.
- `EOM_ОБНОВИТЬ` — пересчет и обновление агрегатов.
- `EOM_ПРОВЕРКА` — проверка проекта.

Excel/ОЛС:

- `EOM_ЭКСПОРТ_EXCEL` — экспорт INPUT.
- `EOM_ИМПОРТ_EXCEL` — импорт OUTPUT.
- `EOM_ПОСТРОИТЬ_ОЛС` — построение однолинейной схемы.
- `EOM_EXCEL_PATH` — установка пути к Excel-файлу.

Компоновка щита:

- `EOM_КОМПОНОВКА_ЩИТА` — построение раскладки аппаратов.
- `EOM_СВЯЗАТЬ_ВИЗУАЛИЗАЦИЮ` / `EOM_BIND_VIS` — привязка правила визуализации.
- `EOM_LAYOUTCFG` — редактор конфигурации компоновки.

Группы и типы прокладки:

- `EOM_АКТИВНАЯ_ГРУППА` — активная группа для новых линий.
- `EOM_НАЗНАЧИТЬ_ГРУППУ` — массовое назначение группы.
- `EOM_НАСТРОЙКИ_ПРОКЛАДКИ` — настройка правил типа прокладки.

## Быстрый старт

1. Откройте AutoCAD.
2. Выполните `NETLOAD`.
3. Загрузите `ElTools.dll`.
4. Откройте вкладку `ЭОМ ПРО`.
5. Запустите базовый сценарий:
- `EOM_MAP` (при необходимости замены блоков),
- `EOM_TRACE`,
- `EOM_SPEC`.

## Рабочий поток Excel и ОЛС

1. `EOM_ЭКСПОРТ_EXCEL` формирует входной набор данных.
2. Выполняется внешний расчет в Excel.
3. `EOM_ИМПОРТ_EXCEL` читает расчетный результат.
4. `EOM_ПОСТРОИТЬ_ОЛС` строит схему на чертеже.

Справка по потоку и маппингу:

- [`docs/EXCEL_OLS_WORKFLOW.md`](docs/EXCEL_OLS_WORKFLOW.md)
- [`docs/OLS_IMPORT_TASK_STATUS.md`](docs/OLS_IMPORT_TASK_STATUS.md)

## Конфигурация

Ключевые файлы конфигурации:

- `Settings.json` — правила и профили маппинга.
- `InstallTypeRules.json` — правила определения типа прокладки.
- `PanelLayoutMap.json` — сопоставление аппаратов и визуализации для компоновки щита.

Файлы размещаются рядом с `ElTools.dll` для предсказуемого рантайма.

## Технический стек

- `C# 12`
- `.NET 8`
- `AutoCAD .NET API` (`AcMgd`, `AcDbMgd`, `AcCoreMgd`)
- `WPF` + `CommunityToolkit.Mvvm`
- `Newtonsoft.Json`

## Архитектура

Проект реализован по методологии GRACE (контракты модулей + граф знаний):

- архитектурные артефакты в `docs/` (`requirements.xml`, `technology.xml`, `development-plan.xml`, `knowledge-graph.xml`);
- модульная структура в `src/` (commands, services, integrations, UI, models, core);
- семантическая разметка в коде (`MODULE_CONTRACT`, `MODULE_MAP`, `CHANGE_SUMMARY`, `START_BLOCK/END_BLOCK`).

## Структура репозитория

- `src/` — исходный код плагина.
- `docs/` — архитектура, процессы, эксплуатационные документы.
- `deploy/` — сборки и скрипты развертывания.
- `tmp/` — рабочие/исследовательские временные материалы.

## Качество и проверка

- проект собирается через `dotnet build ElTools.csproj`;
- в кодовой базе поддерживается GRACE-разметка для навигации и ревью;
- предусмотрен операционный лог по ключевым этапам команд.

## Roadmap (ближайшие шаги)

- усиление качества импорт-потока Excel для граничных кейсов;
- расширение автоматических проверок входных данных;
- развитие UX-конфигураторов и диагностических сообщений для инженеров.

## Лицензия

Условия лицензирования определяются владельцем репозитория. Для коммерческого использования свяжитесь с автором проекта.
