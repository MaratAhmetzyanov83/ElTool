# ElTools - Команды и сценарии запуска

## Быстрый старт
1. В AutoCAD выполните `NETLOAD` и загрузите `ElTools.dll`.
2. Откройте вкладку `ЭОМ ПРО`.
3. Для базовой работы доступны `EOM_MAP`, `EOM_TRACE`, `EOM_SPEC`.
4. Конфиги `Settings.json`, `InstallTypeRules.json`, `PanelLayoutMap.json` хранятся рядом с `ElTools.dll`.

## Excel-поток
1. `EOM_ЭКСПОРТ_EXCEL` - формирует `<template>.INPUT.csv`.
2. Внешний расчет.
3. `EOM_ИМПОРТ_EXCEL` - читает `<template>.OUTPUT.csv`.
4. `EOM_ПОСТРОИТЬ_ОЛС` - строит однолинейную схему по OUTPUT.

## Компоновка щита из выделенной ОЛС
Команда: `EOM_КОМПОНОВКА_ЩИТА`

### Требования
- Пользователь вручную выделяет блоки аппаратов на готовой ОЛС.
- На блоках должны быть атрибуты:
  - `АППАРАТ` (обязательный)
  - `МОДУЛЕЙ` (обязательный, целое > 0)
  - `ГРУППА` (необязательный)
  - `ПРИМЕЧАНИЕ` (необязательный)
- Должен быть настроен `PanelLayoutMap.json`:
  - правило `АППАРАТ -> LayoutBlockName`.

### Что делает команда
1. Запрашивает выделение ОЛС (только `BlockReference`).
2. Читает атрибуты аппаратов.
3. Сопоставляет аппарат с блоком визуализации из `PanelLayoutMap.json`.
4. Запрашивает число модулей в ряду (Enter = дефолт из конфига).
5. Запрашивает точку вставки.
6. Строит DIN-ряды и вставляет блоки визуализации.
7. Выводит отчет по пропущенным объектам.

### Когда объект пропускается
- Нет атрибута `АППАРАТ`.
- Нет/некорректный атрибут `МОДУЛЕЙ`.
- Для `АППАРАТ` нет правила в `PanelLayoutMap.json`.
- В чертеже отсутствует block definition для `LayoutBlockName`.

## Краткая матрица команд
| Команда | Назначение | Основной вход |
|---|---|---|
| `EOM_MAP` | Замена блоков | Выбор исходного и целевого блока |
| `EOM_TRACE` | Трассировка и длины | Магистраль + блоки нагрузок |
| `EOM_SPEC` | Спецификация | Данные модели/XData |
| `EOM_ЭКСПОРТ_EXCEL` | Экспорт INPUT | Агрегаты трасс |
| `EOM_ИМПОРТ_EXCEL` | Импорт OUTPUT | `<template>.OUTPUT.csv` |
| `EOM_ПОСТРОИТЬ_ОЛС` | Построение ОЛС | OUTPUT |
| `EOM_КОМПОНОВКА_ЩИТА` | Компоновка по ОЛС | Выделенная ОЛС + `PanelLayoutMap.json` |
| `EOM_ПРОВЕРКА` | Контроль данных | Текущий чертеж |
| `EOM_АКТИВНАЯ_ГРУППА` | Активная группа линий | Код группы |
| `EOM_НАЗНАЧИТЬ_ГРУППУ` | Массовое назначение группы | Код группы + выбор линий |
| `EOM_НАСТРОЙКИ_ПРОКЛАДКИ` | Правила типов прокладки | Открытие `InstallTypeRules.json` |
